Tue Dec 31 04:46:32 EST 2024
+ hostname
kali
+ ansible-playbook infra.yaml --diff

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host akhkusu-1 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host akhkusu-3 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host akhkusu-2 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [init : Update APT cache] *************************************************
changed: [akhkusu-1]
changed: [akhkusu-2]
changed: [akhkusu-3]

TASK [init : Install Prometheus node exporters] ********************************
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 133 not upgraded.
changed: [akhkusu-1]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 133 not upgraded.
changed: [akhkusu-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 133 not upgraded.
changed: [akhkusu-2]

TASK [init : Modify rsyslog conf file] *****************************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp76kzeh25/rsyslog-tel.conf.j2
@@ -0,0 +1,6 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [akhkusu-1]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp8seij0ol/rsyslog-tel.conf.j2
@@ -0,0 +1,6 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [akhkusu-2]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpeamd2dci/rsyslog-tel.conf.j2
@@ -0,0 +1,6 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format
\ No newline at end of file

changed: [akhkusu-3]

TASK [init : Create backup user] ***********************************************
changed: [akhkusu-1]
changed: [akhkusu-3]
changed: [akhkusu-2]

TASK [init : Add backup server to known hosts] *********************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpa2lmvrkc/known_hosts
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.ak.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [akhkusu-2]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp0gvlvw9b/known_hosts
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.ak.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [akhkusu-1]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp1q2nvlyi/known_hosts
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.ak.io ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
\ No newline at end of file

changed: [akhkusu-3]

TASK [init : Create restore directory] *****************************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0777",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-2]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0777",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-1]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0777",
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-3]

TASK [init : Install duplicity] ************************************************
The following additional packages will be installed:
  librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python-nacl-doc python3-gssapi
  python3-invoke
The following NEW packages will be installed:
  duplicity librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 133 not upgraded.
changed: [akhkusu-2]
The following additional packages will be installed:
  librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python-nacl-doc python3-gssapi
  python3-invoke
The following NEW packages will be installed:
  duplicity librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 133 not upgraded.
changed: [akhkusu-3]
The following additional packages will be installed:
  librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python-nacl-doc python3-gssapi
  python3-invoke
The following NEW packages will be installed:
  duplicity librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 133 not upgraded.
changed: [akhkusu-1]

RUNNING HANDLER [init : Restart rsyslog] ***************************************
changed: [akhkusu-1]
changed: [akhkusu-2]
changed: [akhkusu-3]

PLAY [Bind9] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : install bind9] ****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc resolvconf
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc resolvconf
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
Suggested packages:
  bind-doc resolvconf
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 3 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]

TASK [bind : copy conf.options] ************************************************
--- before: /etc/bind/named.conf.options
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpyy__fos4/named.conf.options.j2
@@ -1,24 +1,22 @@
+acl akinet  { 192.168.42.0/24; 127.0.0.0/8; 172.17.0.0/16;};
+
 options {
-	directory "/var/cache/bind";
+        directory "/var/cache/bind";
+        forwarders {
+                      1.1.1.1;
+                      8.8.8.8;
+                   };
+        allow-query { akinet; };
+        dnssec-validation no;
+};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+key "transfer.key" {
+        algorithm hmac-sha256;
+        secret "fotYfVZUVTbEpQuRUEX6TvCBRFoawpGbzC8kFl6QQFw=";
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
-
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+key "nsupdate.key" {
+        algorithm hmac-sha256;
+        secret "QTrH8AsK5qOrhabgl7jAX3SKshu8ajdlwO0CL+IIed8=";
 };

changed: [akhkusu-2] => (item=options)
--- before: /etc/bind/named.conf.options
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpbaagtk7t/named.conf.options.j2
@@ -1,24 +1,22 @@
+acl akinet  { 192.168.42.0/24; 127.0.0.0/8; 172.17.0.0/16;};
+
 options {
-	directory "/var/cache/bind";
+        directory "/var/cache/bind";
+        forwarders {
+                      1.1.1.1;
+                      8.8.8.8;
+                   };
+        allow-query { akinet; };
+        dnssec-validation no;
+};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+key "transfer.key" {
+        algorithm hmac-sha256;
+        secret "fotYfVZUVTbEpQuRUEX6TvCBRFoawpGbzC8kFl6QQFw=";
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
-
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+key "nsupdate.key" {
+        algorithm hmac-sha256;
+        secret "QTrH8AsK5qOrhabgl7jAX3SKshu8ajdlwO0CL+IIed8=";
 };

changed: [akhkusu-3] => (item=options)
--- before: /etc/bind/named.conf.options
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpp86ix0zj/named.conf.options.j2
@@ -1,24 +1,22 @@
+acl akinet  { 192.168.42.0/24; 127.0.0.0/8; 172.17.0.0/16;};
+
 options {
-	directory "/var/cache/bind";
+        directory "/var/cache/bind";
+        forwarders {
+                      1.1.1.1;
+                      8.8.8.8;
+                   };
+        allow-query { akinet; };
+        dnssec-validation no;
+};
 
-	// If there is a firewall between you and nameservers you want
-	// to talk to, you may need to fix the firewall to allow multiple
-	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113
 
-	// If your ISP provided one or more IP addresses for stable 
-	// nameservers, you probably want to use them as forwarders.  
-	// Uncomment the following block, and insert the addresses replacing 
-	// the all-0's placeholder.
+key "transfer.key" {
+        algorithm hmac-sha256;
+        secret "fotYfVZUVTbEpQuRUEX6TvCBRFoawpGbzC8kFl6QQFw=";
+};
 
-	// forwarders {
-	// 	0.0.0.0;
-	// };
-
-	//========================================================================
-	// If BIND logs error messages about the root key being expired,
-	// you will need to update your keys.  See https://www.isc.org/bind-keys
-	//========================================================================
-	dnssec-validation auto;
-
-	listen-on-v6 { any; };
+key "nsupdate.key" {
+        algorithm hmac-sha256;
+        secret "QTrH8AsK5qOrhabgl7jAX3SKshu8ajdlwO0CL+IIed8=";
 };

changed: [akhkusu-1] => (item=options)
--- before: /etc/bind/named.conf.local
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpy3v1mxv5/named.conf.local.j2
@@ -1,8 +1,18 @@
-//
-// Do any local configuration here
-//
+zone "ak.io" {
+    type secondary;
+    masters {
+    192.168.42.34;
+    };
+    file "db.ak.io";
+};
+zone "168.192.in-addr.arpa" {
+    type secondary;
+    masters {
+    192.168.42.34;
+    };
+    file "rev.db.ak.io";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
-
+server 192.168.42.34 {
+    keys {transfer.key;};
+};

changed: [akhkusu-2] => (item=local)
--- before: /etc/bind/named.conf.local
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp6u7_3xz5/named.conf.local.j2
@@ -1,8 +1,18 @@
-//
-// Do any local configuration here
-//
+zone "ak.io" {
+    type secondary;
+    masters {
+    192.168.42.34;
+    };
+    file "db.ak.io";
+};
+zone "168.192.in-addr.arpa" {
+    type secondary;
+    masters {
+    192.168.42.34;
+    };
+    file "rev.db.ak.io";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
-
+server 192.168.42.34 {
+    keys {transfer.key;};
+};

changed: [akhkusu-1] => (item=local)
--- before: /etc/bind/named.conf.local
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp1hq3wzs3/named.conf.local.j2
@@ -1,8 +1,13 @@
-//
-// Do any local configuration here
-//
+zone "ak.io" {
+    type primary;
+    allow-transfer {key transfer.key;};
+    allow-update {key nsupdate.key;};
+    file "db.ak.io";
+};
+zone "168.192.in-addr.arpa" {
+    type primary;
+    allow-transfer {key transfer.key;};
+    allow-update {key nsupdate.key;};
+    file "rev.db.ak.io";
+};
 
-// Consider adding the 1918 zones here, if they are not used in your
-// organization
-//include "/etc/bind/zones.rfc1918";
-

changed: [akhkusu-3] => (item=local)

TASK [bind : copy zone] ********************************************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpmkpecuhv/zone.j2
@@ -0,0 +1,22 @@
+$TTL	604800
+ak.io.	IN	SOA	akhkusu-2.ak.io. aki.ak.io. (
+			      2		; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+
+ak.io. IN  NS  akhkusu-3
+ak.io. IN  NS  akhkusu-1
+ak.io. IN  NS  akhkusu-2
+
+	
+akhkusu-2 IN A 192.168.42.147
+	
+akhkusu-1 IN A 192.168.42.182
+	
+akhkusu-3 IN A 192.168.42.34
+
+
+backup IN A 192.168.42.132

changed: [akhkusu-3]

TASK [bind : copy reverse zone] ************************************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp2lv7lqne/reverse.zone.conf.j2
@@ -0,0 +1,15 @@
+$TTL    604800
+168.192.in-addr.arpa.    IN    SOA    ak.io. aki.ak.io. (
+                  2      ; Serial
+             604800      ; Refresh
+              86400      ; Retry
+            2419200      ; Expire
+             604800 )    ; Negative Cache TTL
+;
+168.192.in-addr.arpa. IN   NS  akhkusu-3.ak.io.
+168.192.in-addr.arpa. IN   NS  akhkusu-1.ak.io.
+168.192.in-addr.arpa. IN   NS  akhkusu-2.ak.io.
+; PTR Records
+147.42 IN PTR akhkusu-2.ak.io.
+182.42 IN PTR akhkusu-1.ak.io.
+34.42 IN PTR akhkusu-3.ak.io.

changed: [akhkusu-3]

TASK [bind : Download Bind9 Exporter archive] **********************************
changed: [akhkusu-2]
changed: [akhkusu-1]
changed: [akhkusu-3]

TASK [bind : Extract Bind9 Exporter archive] ***********************************
changed: [akhkusu-1]
changed: [akhkusu-2]
changed: [akhkusu-3]

TASK [bind : Create symbolic link to exporter executable] **********************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/usr/local/bin/prometheus-bind-exporter",
-    "state": "absent"
+    "state": "link"
 }

changed: [akhkusu-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/usr/local/bin/prometheus-bind-exporter",
-    "state": "absent"
+    "state": "link"
 }

changed: [akhkusu-3]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/usr/local/bin/prometheus-bind-exporter",
-    "state": "absent"
+    "state": "link"
 }

changed: [akhkusu-2]

TASK [bind : Create systemd service definition for Bind9 Exporter] *************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmprduct5so/bind_exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=Prometheus Bind9 Exporter
+After=network.target
+
+[Service]
+User=bind
+Group=bind
+ExecStart=/usr/local/bin/prometheus-bind-exporter
+Restart=always
+
+[Install]
+WantedBy=multi-user.target

changed: [akhkusu-1]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpww97hce7/bind_exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=Prometheus Bind9 Exporter
+After=network.target
+
+[Service]
+User=bind
+Group=bind
+ExecStart=/usr/local/bin/prometheus-bind-exporter
+Restart=always
+
+[Install]
+WantedBy=multi-user.target

changed: [akhkusu-2]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpq7uardam/bind_exporter.service.j2
@@ -0,0 +1,12 @@
+[Unit]
+Description=Prometheus Bind9 Exporter
+After=network.target
+
+[Service]
+User=bind
+Group=bind
+ExecStart=/usr/local/bin/prometheus-bind-exporter
+Restart=always
+
+[Install]
+WantedBy=multi-user.target

changed: [akhkusu-3]

TASK [bind : Make sure bind9 and exporter are running] *************************
ok: [akhkusu-3] => (item=bind9)
ok: [akhkusu-2] => (item=bind9)
ok: [akhkusu-1] => (item=bind9)
changed: [akhkusu-2] => (item=bind_exporter)
changed: [akhkusu-3] => (item=bind_exporter)
changed: [akhkusu-1] => (item=bind_exporter)

TASK [bind : Run handlers] *****************************************************

TASK [bind : Run handlers] *****************************************************

TASK [bind : Run handlers] *****************************************************

RUNNING HANDLER [bind : Restart bind9] *****************************************
changed: [akhkusu-3]
changed: [akhkusu-2]
changed: [akhkusu-1]

RUNNING HANDLER [bind : RNDC Reload] *******************************************
changed: [akhkusu-3]
changed: [akhkusu-1]
changed: [akhkusu-2]

RUNNING HANDLER [bind : Reload systemd daemon] *********************************
changed: [akhkusu-3]
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [bind : install dependency for nsupdate] **********************************
The following additional packages will be installed:
  python3-requests-toolbelt
Suggested packages:
  python3-sniffio python3-trio
The following NEW packages will be installed:
  python3-dnspython python3-requests-toolbelt
0 upgraded, 2 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
The following additional packages will be installed:
  python3-requests-toolbelt
Suggested packages:
  python3-sniffio python3-trio
The following NEW packages will be installed:
  python3-dnspython python3-requests-toolbelt
0 upgraded, 2 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-3]
The following additional packages will be installed:
  python3-requests-toolbelt
Suggested packages:
  python3-sniffio python3-trio
The following NEW packages will be installed:
  python3-dnspython python3-requests-toolbelt
0 upgraded, 2 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]

TASK [bind : Add A backup record on backup dns servers] ************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
changed: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3, akhkusu-1, akhkusu-2

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-3]
changed: [akhkusu-1]
changed: [akhkusu-2]

PLAY [dns] *********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [dns : Resolv.conf] *******************************************************
--- before: /etc/resolv.conf
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpl21_z32y/resolv.conf.j2
@@ -1,23 +1,3 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.42.182
+nameserver 192.168.42.147
+search ak.io
\ No newline at end of file

changed: [akhkusu-2]
--- before: /etc/resolv.conf
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp0ufeu_38/resolv.conf.j2
@@ -1,23 +1,3 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.42.182
+nameserver 192.168.42.147
+search ak.io
\ No newline at end of file

changed: [akhkusu-1]
--- before: /etc/resolv.conf
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp0ejdqw06/resolv.conf.j2
@@ -1,23 +1,3 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
-
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal
+nameserver 192.168.42.182
+nameserver 192.168.42.147
+search ak.io
\ No newline at end of file

changed: [akhkusu-3]

TASK [dns : Stop systemd-resolved] *********************************************
changed: [akhkusu-2]
changed: [akhkusu-1]
changed: [akhkusu-3]

PLAY [docker] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [docker : Install docker] *************************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz python3-websocket runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz python3-docker
  python3-websocket runc ubuntu-fan
0 upgraded, 9 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-3]

TASK [docker : Start docker] ***************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : install MySQL] ***************************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libbusiness-isbn-perl libwww-perl
  mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 27 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libbusiness-isbn-perl libwww-perl
  mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 27 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]

TASK [mysql : Manage mysql host] ***********************************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpjgbmcgp1/override.cnf.j2
@@ -0,0 +1,8 @@
+[mysqld]
+bind-address = 0.0.0.0
+
+
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 182
\ No newline at end of file

changed: [akhkusu-1]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpaidup9nk/override.cnf.j2
@@ -0,0 +1,8 @@
+[mysqld]
+bind-address = 0.0.0.0
+
+
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 147
\ No newline at end of file

changed: [akhkusu-2]

TASK [mysql : install PyMySQL] *************************************************
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]

TASK [mysql : Create MySQL database] *******************************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [mysql : MySQL user] ******************************************************
[WARNING]: Option column_case_sensitive is not provided. The default is now
false, so the column's name will be uppercased. The default will be changed to
true in community.mysql 4.0.0.
changed: [akhkusu-1]
changed: [akhkusu-2]

TASK [mysql : Make sure mysql is running] **************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : MySQL Exporter User] *********************************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [mysql : MySQL Exporter Config] *******************************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [mysql : Install MySQL Exporter] ******************************************
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]

TASK [mysql : Enable MySQL Exporter] *******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Add mysql replication user] **************************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [mysql : Configure mysql dynamic variables for replica] *******************
changed: [akhkusu-1]
changed: [akhkusu-2]

TASK [mysql : Create backup directory for mysql] *******************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0777",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-2]
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0777",
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-1]

TASK [mysql : Create mysql backup user] ****************************************
changed: [akhkusu-1]
changed: [akhkusu-2]

TASK [mysql : Create backup user credentials to access mysql] ******************
changed: [akhkusu-1]
changed: [akhkusu-2]

TASK [mysql : Create scheduled mysql backup task with cron] ********************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmptho1fwk1/cron-mysql-backup.j2
@@ -0,0 +1 @@
+

changed: [akhkusu-1]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmprjhfnajw/cron-mysql-backup.j2
@@ -0,0 +1,4 @@
+0 20 * * * backup mysqldump agama > /home/backup/mysql/agama.sql
+15 20 * * 0  backup  duplicity --no-encryption full /home/backup/mysql/ rsync://akhkusu@backup.ak.io/mysql --allow-source-mismatch
+20 20 * * 1-6  backup  duplicity --no-encryption incremental /home/backup/mysql/ rsync://akhkusu@backup.ak.io/mysql --allow-source-mismatch
+

changed: [akhkusu-2]

TASK [add cnames] **************************************************************
included: cname for akhkusu-2, akhkusu-1

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-1]
changed: [akhkusu-2]

RUNNING HANDLER [mysql : Restart mysql] ****************************************
changed: [akhkusu-2]
changed: [akhkusu-1]

RUNNING HANDLER [mysql : Restart MySQL Exporter] *******************************
changed: [akhkusu-1]
changed: [akhkusu-2]

RUNNING HANDLER [mysql : Reset MySQL source] ***********************************
skipping: [akhkusu-2] => (item=stopreplica) 
skipping: [akhkusu-2] => (item=resetprimary) 
skipping: [akhkusu-2]
changed: [akhkusu-1] => (item=stopreplica)
changed: [akhkusu-1] => (item=resetprimary)

RUNNING HANDLER [mysql : Reset MySQL replica] **********************************
skipping: [akhkusu-1] => (item=stopreplica) 
skipping: [akhkusu-1] => (item=changeprimary) 
skipping: [akhkusu-1] => (item=resetreplica) 
skipping: [akhkusu-1] => (item=startreplica) 
skipping: [akhkusu-1]
changed: [akhkusu-2] => (item=stopreplica)
changed: [akhkusu-2] => (item=changeprimary)
changed: [akhkusu-2] => (item=resetreplica)
changed: [akhkusu-2] => (item=startreplica)

PLAY [Agama_servers] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [agama : Create agama volume directory] ***********************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-3]

TASK [agama : Download agama files] ********************************************
changed: [akhkusu-2] => (item=agama.py)
changed: [akhkusu-1] => (item=agama.py)
changed: [akhkusu-3] => (item=agama.py)
changed: [akhkusu-3] => (item=Dockerfile)
changed: [akhkusu-1] => (item=Dockerfile)
changed: [akhkusu-2] => (item=Dockerfile)

TASK [agama : Create agama docker image] ***************************************
changed: [akhkusu-2]
changed: [akhkusu-1]
changed: [akhkusu-3]

TASK [agama : Start agama docker container] ************************************
changed: [akhkusu-1] => (item=None)
changed: [akhkusu-2] => (item=None)
changed: [akhkusu-3] => (item=None)
changed: [akhkusu-1] => (item=None)
changed: [akhkusu-2] => (item=None)
changed: [akhkusu-2] => (item=None)
changed: [akhkusu-2]
changed: [akhkusu-1] => (item=None)
changed: [akhkusu-1]
changed: [akhkusu-3] => (item=None)
changed: [akhkusu-3] => (item=None)
changed: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-1, akhkusu-2, akhkusu-3

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-2]
changed: [akhkusu-1]
changed: [akhkusu-3]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [prometheus : Install Prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
Suggested packages:
  apache2 | lighttpd | httpd
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
  prometheus
0 upgraded, 16 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-3]

TASK [prometheus : Modify /etc/prometheus/prometheus.yml] **********************
--- before: /etc/prometheus/prometheus.yml
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpyqcxzesz/prometheus.yml.j2
@@ -1,44 +1,85 @@
-# Sample config for Prometheus.
+global:
+  scrape_interval:     15s 
+  evaluation_interval: 15s 
 
-global:
-  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
-  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
-
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
-  external_labels:
-      monitor: 'example'
-
-# Alertmanager configuration
-alerting:
-  alertmanagers:
-  - static_configs:
-    - targets: ['localhost:9093']
-
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
-
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
 scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
   - job_name: 'prometheus'
 
-    # Override the global default and scrape targets from this job every 5 seconds.
     scrape_interval: 5s
     scrape_timeout: 5s
 
-    # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
-
+    metrics_path: /prometheus/metrics
+    
     static_configs:
       - targets: ['localhost:9090']
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
+  
+  - job_name: linux
     static_configs:
-      - targets: ['localhost:9100']
+      - targets:
+        
+        - akhkusu-2:9100
+        
+        - akhkusu-1:9100
+        
+        - akhkusu-3:9100
+          
+  - job_name: bind9
+    static_configs:
+      - targets:
+        
+        - akhkusu-3:9119
+        
+        - akhkusu-1:9119
+        
+        - akhkusu-2:9119
+          
+  - job_name: mysql
+    static_configs:
+      - targets:
+        
+        - akhkusu-2:9104
+        
+        - akhkusu-1:9104
+          
+  - job_name: nginx
+    static_configs:
+      - targets:
+        
+        - akhkusu-1:9113
+        
+        - akhkusu-2:9113
+        
+        - akhkusu-3:9113
+          
+  - job_name: influxdb
+    static_configs:
+      - targets:
+        
+        - akhkusu-3:9424
+          
+  - job_name: haproxy
+    static_configs:
+      - targets:
+        
+        - akhkusu-1:9101
+        
+        - akhkusu-2:9101
+          
+  - job_name: keepalived
+    static_configs:
+      - targets:
+        
+        - akhkusu-1:9165
+        
+        - akhkusu-2:9165
+          
+
+
+  - job_name: backup
+    static_configs:
+      - targets:
+        - backup.ak.io:9111
+
+  
+  

changed: [akhkusu-3]

TASK [prometheus : Copy Prometheus default file] *******************************
--- before: /etc/default/prometheus
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmptdu5vyal/prometheus_default.j2
@@ -1,110 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell escaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# prometheus supports the following options:
-#
-#  --alertmanager.notification-queue-capacity=10000
-#    The capacity of the queue for pending Alertmanager notifications.
-#  --config.file="/etc/prometheus/prometheus.yml"
-#    Prometheus configuration file path.
-#  --enable-feature=<feature,...>
-#    Comma separated feature names to enable. Valid options:
-#    exemplar-storage, expand-external-labels, memory-snapshot-on-shutdown,
-#    promql-at-modifier, promql-negative-offset, remote-write-receiver,
-#    extra-scrape-metrics, new-service-discovery-manager. See
-#    https://prometheus.io/docs/prometheus/latest/feature_flags/ for more
-#    details.
-#  --log.format=logfmt
-#    Output format of log messages. One of: [logfmt, json].
-#  --log.level=info
-#    Only log messages with the given severity or above. One of: [debug, info,
-#    warn, error].
-#  --query.lookback-delta=5m
-#    The maximum lookback duration for retrieving metrics during expression
-#    evaluations and federation.
-#  --query.max-concurrency=20
-#    Maximum number of queries executed concurrently.
-#  --query.max-samples=50000000
-#    Maximum number of samples a single query can load into memory. Note that
-#    queries will fail if they try to load more samples than this into memory,
-#    so this also limits the number of samples a query can return.
-#  --query.timeout=2m
-#    Maximum time a query may take before being aborted.
-#  --rules.alert.for-grace-period=10m
-#    Minimum duration between alert and restored "for" state. This is
-#    maintained only for alerts with configured "for" time greater than grace
-#    period.
-#  --rules.alert.for-outage-tolerance=1h
-#    Max time to tolerate prometheus outage for restoring "for" state of alert.
-#  --rules.alert.resend-delay=1m
-#    Minimum amount of time to wait before resending an alert to Alertmanager.
-#  --storage.remote.flush-deadline=<duration>
-#    How long to wait flushing sample on shutdown or config reload.
-#  --storage.remote.read-concurrent-limit=10
-#    Maximum number of concurrent remote read calls. 0 means no limit.
-#  --storage.remote.read-max-bytes-in-frame=1048576
-#    Maximum number of bytes in a single frame for streaming remote read
-#    response types before marshalling. Note that client might have limit on
-#    frame size as well. 1MB as recommended by protobuf by default.
-#  --storage.remote.read-sample-limit=5e7
-#    Maximum overall number of samples to return via the remote read interface,
-#    in a single query. 0 means no limit. This limit is ignored for streamed
-#    response types.
-#  --storage.tsdb.allow-overlapping-blocks
-#    Allow overlapping blocks, which in turn enables vertical compaction and
-#    vertical query merge.
-#  --storage.tsdb.path="/var/lib/prometheus/metrics2/"
-#    Base path for metrics storage.
-#  --storage.tsdb.retention.size=STORAGE.TSDB.RETENTION.SIZE
-#    Maximum number of bytes that can be stored for blocks. A unit is required,
-#    supported units: B, KB, MB, GB, TB, PB, EB. Ex: "512MB".
-#  --storage.tsdb.retention.time=STORAGE.TSDB.RETENTION.TIME
-#    How long to retain samples in storage. When this flag is set it overrides
-#    "storage.tsdb.retention". If neither this flag nor
-#    "storage.tsdb.retention" nor "storage.tsdb.retention.size" is set, the
-#    retention time defaults to 15d. Units Supported: y, w, d, h, m, s, ms.
-#  --storage.tsdb.retention=STORAGE.TSDB.RETENTION
-#    [DEPRECATED] How long to retain samples in storage. This flag has been
-#    deprecated, use "storage.tsdb.retention.time" instead.
-#  --storage.tsdb.use-lockfile
-#    Create a lockfile in data directory.
-#  --web.config.file=""
-#    [EXPERIMENTAL] Path to configuration file that can enable TLS or
-#    authentication.
-#  --web.console.libraries="/etc/prometheus/console_libraries"
-#    Path to the console library directory.
-#  --web.console.templates="/etc/prometheus/consoles"
-#    Path to the console template directory, available at /consoles.
-#  --web.cors.origin=".*"
-#    Regex for CORS origin. It is fully anchored. Example:
-#    'https?://(domain1|domain2)\.com'.
-#  --web.enable-admin-api
-#    Enable API endpoints for admin control actions.
-#  --web.enable-lifecycle
-#    Enable shutdown and reload via HTTP request.
-#  --web.external-url=<URL>
-#    The URL under which Prometheus is externally reachable (for example, if
-#    Prometheus is served via a reverse proxy). Used for generating relative
-#    and absolute links back to Prometheus itself. If the URL has a path
-#    portion, it will be used to prefix all HTTP endpoints served by
-#    Prometheus. If omitted, relevant URL components will be derived
-#    automatically.
-#  --web.listen-address="0.0.0.0:9090"
-#    Address to listen on for UI, API, and telemetry.
-#  --web.local-assets="/usr/share/prometheus/web/"
-#    Path to static asset/templates directory.
-#  --web.max-connections=512
-#    Maximum number of simultaneous connections.
-#  --web.page-title="Prometheus Time Series Collection and Processing Server"
-#    Document title of Prometheus instance.
-#  --web.read-timeout=5m
-#    Maximum duration before timing out read of the request, and closing idle
-#    connections.
-#  --web.route-prefix=<path>
-#    Prefix for the internal routes of web endpoints. Defaults to path of
-#    --web.external-url.
-#  --web.user-assets=<path>
-#    Path to user asset directory, available at /user.
+ARGS="--web.external-url=http://193.40.156.67:3480/prometheus"
\ No newline at end of file

changed: [akhkusu-3]

TASK [prometheus : Enable Prometheus] ******************************************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-3]

RUNNING HANDLER [prometheus : Restart Prometheus] ******************************
changed: [akhkusu-3]

PLAY [Influxdb] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [influxdb : Download influxdb] ********************************************
changed: [akhkusu-3]

TASK [influxdb : Install influxdb] *********************************************
Selecting previously unselected package influxdb.
(Reading database ... 59388 files and directories currently installed.)
Preparing to unpack /home/ubuntu/influxdb ...
Unpacking influxdb (1.8.10-1) ...
Setting up influxdb (1.8.10-1) ...
Processing triggers for man-db (2.10.2-1) ...
changed: [akhkusu-3]

TASK [influxdb : Configure influxdb] *******************************************
--- before: /etc/influxdb/influxdb.conf
+++ after: /home/aki/ica0002/roles/influxdb/files/influxdb.conf
@@ -65,7 +65,7 @@
 
   # Whether queries should be logged before execution. Very useful for troubleshooting, but will
   # log any sensitive data contained within a query.
-  # query-log-enabled = true
+  query-log-enabled = false
 
   # Provides more error checking. For example, SELECT INTO will err out inserting an +/-Inf value
   # rather than silently failing.
@@ -266,7 +266,7 @@
   # realm = "InfluxDB"
 
   # Determines whether HTTP request logging is enabled.
-  # log-enabled = true
+  log-enabled = false
 
   # Determines whether the HTTP write request logs should be suppressed when the log is enabled.
   # suppress-write-log = false
@@ -286,7 +286,7 @@
   # access-log-status-filters = []
 
   # Determines whether detailed write logging is enabled.
-  # write-tracing = false
+  write-tracing = false
 
   # Determines whether the pprof endpoint is enabled.  This endpoint is used for
   # troubleshooting and monitoring.
@@ -345,11 +345,11 @@
   # Setting this to 0 or setting max-concurrent-write-limit to 0 disables the limit.
   # enqueued-write-timeout = 0
 
-	# User supplied HTTP response headers
-	#
-	# [http.headers]
-	#   X-Header-1 = "Header Value 1"
-	#   X-Header-2 = "Header Value 2"
+        # User supplied HTTP response headers
+        #
+        # [http.headers]
+        #   X-Header-1 = "Header Value 1"
+        #   X-Header-2 = "Header Value 2"
 
 ###
 ### [logging]
@@ -593,4 +593,4 @@
 
   # Maximum version of the tls protocol that will be negotiated. If not specified, uses the
   # default settings from Go's crypto/tls package.
-  # max-version = "tls1.3"
+  # max-version = "tls1.3"
\ No newline at end of file

changed: [akhkusu-3]

TASK [influxdb : Activate influxdb] ********************************************
changed: [akhkusu-3]

TASK [influxdb : Get telegraf key] *********************************************
changed: [akhkusu-3]

TASK [influxdb : Get telegraf source with apt] *********************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/influxdata.list.list
@@ -0,0 +1 @@
+deb [signed-by=/etc/apt/trusted.gpg.d/influxdata-archive_compat.gpg] https://repos.influxdata.com/debian stable main

changed: [akhkusu-3]

TASK [influxdb : Install telegraf from source] *********************************
The following NEW packages will be installed:
  telegraf
0 upgraded, 1 newly installed, 0 to remove and 131 not upgraded.
changed: [akhkusu-3]

TASK [influxdb : Configure telegraf] *******************************************
diff skipped: destination file size is greater than 104448
changed: [akhkusu-3]

TASK [influxdb : Download influxdb exporter] ***********************************
changed: [akhkusu-3]

TASK [influxdb : Create influxdb-exporter service] *****************************
--- before
+++ after: /home/aki/ica0002/roles/influxdb/files/influxdb-stats-exporter.service
@@ -0,0 +1,10 @@
+[Unit]
+Description=Send InfluxDB logs to Prometheus
+After=network-online.target
+
+[Service]
+User=prometheus
+ExecStart=/usr/local/bin/influx_stats_exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [akhkusu-3]

TASK [influxdb : Start prometheus-influxdb-stats-exporter] *********************
changed: [akhkusu-3]

TASK [influxdb : Create backup directory for influxdb] *************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0777",
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-3]

TASK [influxdb : Create scheduled influxdb backup task with cron] **************
--- before
+++ after: /home/aki/ica0002/roles/influxdb/files/cron-influxdb-backup
@@ -0,0 +1,3 @@
+0 21 * * * backup rm -rf /home/backup/influxdb/*; influxd backup -portable -database telegraf /home/backup/influxdb
+15 21 * * 0  backup  duplicity --no-encryption full /home/backup/influxdb/ rsync://akhkusu@backup.ak.io/influxdb
+20 21 * * 1-6  backup  duplicity --no-encryption incremental /home/backup/influxdb/ rsync://akhkusu@backup.ak.io/influxdb

changed: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-3]

RUNNING HANDLER [influxdb : Restart influxdb] **********************************
changed: [akhkusu-3]

RUNNING HANDLER [influxdb : Restart telegraf] **********************************
changed: [akhkusu-3]

RUNNING HANDLER [influxdb : Restart systemctl daemon] **************************
ok: [akhkusu-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [grafana : Create volume directories] *************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-3] => (item=dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-3] => (item=datasources)

TASK [grafana : Copy grafana configs to volume] ********************************
changed: [akhkusu-3]

TASK [grafana : Copy dashboards config to volume] ******************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpb0k29ifk/dashboards.yaml.j2
@@ -0,0 +1,11 @@
+# # config file version
+apiVersion: 1
+
+providers:
+ - name: 'Main'
+   orgId: 1
+   folder: ''
+   folderUid: ''
+   type: file
+   options:
+     path: /etc/grafana/provisioning/dashboards
\ No newline at end of file

changed: [akhkusu-3]

TASK [grafana : Copy datasources config to volume] *****************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpyop43fmf/datasources.yaml.j2
@@ -0,0 +1,29 @@
+apiVersion: 1
+
+datasources:
+  - name: Prometheus
+    type: prometheus
+    access: proxy
+    orgId: 1
+    url: http://akhkusu-2:9090/prometheus
+    isDefault: true
+    version: 1
+    editable: true
+
+  - name: InfluxDB
+    type: influxdb
+    access: proxy
+    orgId: 1
+    url: http://akhkusu-2:8086
+    database: latency
+    version: 1
+    editable: true
+
+  - name: InfluxDB-telegraf
+    type: influxdb
+    access: proxy
+    orgId: 1
+    url: http://akhkusu-2:8086
+    database: telegraf
+    version: 1
+    editable: true
\ No newline at end of file

changed: [akhkusu-3]

TASK [grafana : Copy all dashboards to volume] *********************************
--- before
+++ after: /home/aki/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1082 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "grafana",
+            "uid": "-- Grafana --"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "type": "dashboard"
+        }
+      ]
+    },
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "graphTooltip": 0,
+    "links": [],
+    "liveNow": false,
+    "panels": [
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 0
+        },
+        "id": 12,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "influxdb_write_write_ok",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "InfluxDB write rate ",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 8
+        },
+        "id": 11,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "influxdb_exporter_stats_query_success",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "InfluxDB health ",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "influxdb",
+          "uid": "P1CD674AE23E48869"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "displayName": "latency",
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": [
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "Value"
+              },
+              "properties": []
+            }
+          ]
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 16
+        },
+        "id": 10,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "influxdb",
+              "uid": "P1CD674AE23E48869"
+            },
+            "query": "SELECT * FROM \"rtt\" WHERE \"dst\" = '8.8.8.8'\n",
+            "rawQuery": true,
+            "refId": "A",
+            "resultFormat": "time_series"
+          },
+          {
+            "datasource": {
+              "type": "influxdb",
+              "uid": "P1CD674AE23E48869"
+            },
+            "hide": false,
+            "query": "SELECT * FROM \"rtt\" WHERE \"dst\" = 'google.com'",
+            "rawQuery": true,
+            "refId": "B",
+            "resultFormat": "time_series"
+          },
+          {
+            "datasource": {
+              "type": "influxdb",
+              "uid": "P1CD674AE23E48869"
+            },
+            "hide": false,
+            "query": "SELECT * FROM \"rtt\" WHERE \"dst\" = 'taltech.ee'",
+            "rawQuery": true,
+            "refId": "C",
+            "resultFormat": "time_series"
+          }
+        ],
+        "title": "Ping Latency",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "DOWN"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "UP"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 0.5
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 24
+        },
+        "id": 9,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "bind_up",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Bind9",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "DOWN"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "UP"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 0.5
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 32
+        },
+        "id": 8,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "nginx_up",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Nginx",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "DOWN"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "UP"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 0.5
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 40
+        },
+        "id": 7,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "10.2.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "mysql_up",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 48
+        },
+        "id": 6,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "rate(nginx_http_requests_total[1m])*60",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Nginx Requests Per Min",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 56
+        },
+        "id": 5,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m])*60\r\n",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL \"Selects\" Per Min",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 64
+        },
+        "id": 4,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m]) * 60\r\n",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "DNS Queries Per Min",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            },
+            "unit": "percent"
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 72
+        },
+        "id": 3,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "((node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)/node_memory_MemTotal_bytes)*100",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Memory Consumption on VMs",
+        "type": "timeseries"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "drawStyle": "line",
+              "fillOpacity": 0,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineWidth": 1,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            },
+            "unit": "percent"
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 8,
+          "w": 12,
+          "x": 0,
+          "y": 80
+        },
+        "id": 2,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "single",
+            "sort": "none"
+          }
+        },
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "e43981ca-111b-4cac-ad65-c67b18c3a50a"
+            },
+            "editorMode": "code",
+            "expr": "(rate(node_load1[1m]))*1000",
+            "instant": false,
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "CPU load",
+        "type": "timeseries"
+      }
+    ],
+    "refresh": "",
+    "schemaVersion": 38,
+    "tags": [],
+    "templating": {
+      "list": []
+    },
+    "time": {
+      "from": "now-3h",
+      "to": "now"
+    },
+    "timepicker": {},
+    "timezone": "",
+    "title": "Main",
+    "uid": "f5d4f811-c98f-43c9-a448-cb7cb5cdeb03",
+    "version": 1,
+    "weekStart": ""
+  }
+  
\ No newline at end of file

changed: [akhkusu-3] => (item=main.json)
--- before
+++ after: /home/aki/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,436 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 2,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 0,
+        "y": 0
+      },
+      "id": 5,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_up",
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 6,
+        "x": 6,
+        "y": 0
+      },
+      "id": 1,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_server_id",
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL id",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "index": 0,
+                  "text": "Read/Write"
+                },
+                "1": {
+                  "index": 1,
+                  "text": "Read only"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_global_variables_read_only",
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Server Mode",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "blue",
+                  "index": 1,
+                  "text": "Stopped"
+                },
+                "1": {
+                  "color": "blue",
+                  "index": 0,
+                  "text": "Running"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 8
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_sql_running{master_uuid!=\"\"}",
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "SQL Status",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "blue",
+                  "index": 1,
+                  "text": "Stopped"
+                },
+                "1": {
+                  "color": "blue",
+                  "index": 0,
+                  "text": "Running"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 8
+      },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "code",
+          "expr": "mysql_slave_status_slave_io_running{master_uuid!=\"\"}",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "I/O Status",
+      "type": "stat"
+    }
+  ],
+  "preload": false,
+  "refresh": "5s",
+  "schemaVersion": 40,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-3h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "MySQL Health",
+  "uid": "ceb04da1-1169-4b49-a0b9-0d85451d76d0",
+  "version": 3,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [akhkusu-3] => (item=mysql.json)
--- before
+++ after: /home/aki/ica0002/roles/grafana/files/syslog.json
@@ -0,0 +1,1028 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "datasource",
+            "uid": "grafana"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "type": "dashboard"
+        }
+      ]
+    },
+    "description": "Telegraf / InfluxDB / Grafana as syslog receiver",
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "gnetId": 12433,
+    "graphTooltip": 0,
+    "id": 3,
+    "links": [],
+    "liveNow": false,
+    "panels": [
+      {
+        "aliasColors": {},
+        "bars": true,
+        "dashLength": 10,
+        "dashes": false,
+        "datasource": {
+          "type": "influxdb",
+          "uid": "PDD5124384626356D"
+        },
+        "decimals": 0,
+        "fill": 1,
+        "fillGradient": 0,
+        "gridPos": {
+          "h": 7,
+          "w": 24,
+          "x": 0,
+          "y": 0
+        },
+        "hiddenSeries": false,
+        "id": 10,
+        "interval": "",
+        "legend": {
+          "alignAsTable": true,
+          "avg": true,
+          "current": false,
+          "max": true,
+          "min": false,
+          "rightSide": true,
+          "show": true,
+          "total": true,
+          "values": true
+        },
+        "lines": false,
+        "linewidth": 1,
+        "links": [],
+        "nullPointMode": "connected",
+        "options": {
+          "alertThreshold": true
+        },
+        "percentage": false,
+        "pluginVersion": "10.2.2",
+        "pointradius": 2,
+        "points": false,
+        "renderer": "flot",
+        "seriesOverrides": [
+          {
+            "alias": "Info",
+            "color": "rgb(80, 80, 80)",
+            "stack": "A"
+          },
+          {
+            "alias": "Notice",
+            "color": "rgb(182, 182, 182)",
+            "stack": "A"
+          },
+          {
+            "alias": "Warning",
+            "color": "#E0B400",
+            "stack": "A"
+          },
+          {
+            "alias": "Error",
+            "color": "#FF780A",
+            "stack": "A"
+          },
+          {
+            "alias": "Critical",
+            "color": "#E02F44",
+            "stack": "A"
+          },
+          {
+            "alias": "Alert",
+            "color": "#8F3BB8",
+            "stack": "A"
+          },
+          {
+            "alias": "Emergency",
+            "color": "#8F3BB8",
+            "stack": "A"
+          }
+        ],
+        "spaceLength": 10,
+        "stack": false,
+        "steppedLine": false,
+        "targets": [
+          {
+            "alias": "Info",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "A",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "info"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Notice",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "B",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "notice"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Warning",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "D",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "warning"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Error",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "C",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "err"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Critical",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "E",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "crit"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Alert",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "F",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "alert"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          },
+          {
+            "alias": "Emergency",
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "1m"
+                ],
+                "type": "time"
+              },
+              {
+                "params": [
+                  "null"
+                ],
+                "type": "fill"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "G",
+            "resultFormat": "time_series",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                },
+                {
+                  "params": [],
+                  "type": "count"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "severity",
+                "operator": "=",
+                "value": "emerg"
+              },
+              {
+                "condition": "AND",
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          }
+        ],
+        "thresholds": [],
+        "timeRegions": [],
+        "title": "syslog count",
+        "tooltip": {
+          "shared": true,
+          "sort": 0,
+          "value_type": "individual"
+        },
+        "type": "graph",
+        "xaxis": {
+          "mode": "time",
+          "show": true,
+          "values": []
+        },
+        "yaxes": [
+          {
+            "decimals": 0,
+            "format": "none",
+            "label": "Messages / min",
+            "logBase": 1,
+            "show": true
+          },
+          {
+            "format": "short",
+            "logBase": 1,
+            "show": false
+          }
+        ],
+        "yaxis": {
+          "align": false
+        }
+      },
+      {
+        "datasource": {
+          "type": "influxdb",
+          "uid": "PDD5124384626356D"
+        },
+        "description": "",
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "custom": {
+              "align": "left",
+              "cellOptions": {
+                "type": "auto"
+              },
+              "filterable": false,
+              "inspect": false
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "dark-purple"
+                },
+                {
+                  "color": "dark-red",
+                  "value": 2
+                },
+                {
+                  "color": "dark-orange",
+                  "value": 3
+                },
+                {
+                  "color": "dark-yellow",
+                  "value": 4
+                },
+                {
+                  "color": "rgb(150, 150, 150)",
+                  "value": 5
+                },
+                {
+                  "color": "rgb(51, 51, 51)",
+                  "value": 6
+                },
+                {
+                  "color": "rgb(5, 5, 5)",
+                  "value": 7
+                }
+              ]
+            }
+          },
+          "overrides": [
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "severity_code"
+              },
+              "properties": [
+                {
+                  "id": "mappings",
+                  "value": [
+                    {
+                      "options": {
+                        "0": {
+                          "text": "Emergency"
+                        },
+                        "1": {
+                          "text": "Alert"
+                        },
+                        "2": {
+                          "text": "Critical"
+                        },
+                        "3": {
+                          "text": "Error"
+                        },
+                        "4": {
+                          "text": "Warning"
+                        },
+                        "5": {
+                          "text": "Notice"
+                        },
+                        "6": {
+                          "text": "Info"
+                        },
+                        "7": {
+                          "text": "Debug"
+                        }
+                      },
+                      "type": "value"
+                    }
+                  ]
+                },
+                {
+                  "id": "custom.cellOptions",
+                  "value": {
+                    "mode": "gradient",
+                    "type": "color-background"
+                  }
+                },
+                {
+                  "id": "custom.width",
+                  "value": 119
+                }
+              ]
+            },
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "Time"
+              },
+              "properties": [
+                {
+                  "id": "custom.width",
+                  "value": 163
+                }
+              ]
+            },
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "hostname"
+              },
+              "properties": [
+                {
+                  "id": "custom.width",
+                  "value": 194
+                }
+              ]
+            },
+            {
+              "matcher": {
+                "id": "byName",
+                "options": "appname"
+              },
+              "properties": [
+                {
+                  "id": "custom.width",
+                  "value": 264
+                }
+              ]
+            }
+          ]
+        },
+        "gridPos": {
+          "h": 24,
+          "w": 24,
+          "x": 0,
+          "y": 7
+        },
+        "id": 12,
+        "options": {
+          "cellHeight": "sm",
+          "footer": {
+            "countRows": false,
+            "fields": "",
+            "reducer": [
+              "sum"
+            ],
+            "show": false
+          },
+          "showHeader": true,
+          "sortBy": [
+            {
+              "desc": true,
+              "displayName": "Time"
+            }
+          ]
+        },
+        "pluginVersion": "10.2.2",
+        "targets": [
+          {
+            "datasource": {
+              "type": "influxdb",
+              "uid": "PDD5124384626356D"
+            },
+            "groupBy": [
+              {
+                "params": [
+                  "hostname"
+                ],
+                "type": "tag"
+              },
+              {
+                "params": [
+                  "appname"
+                ],
+                "type": "tag"
+              }
+            ],
+            "measurement": "syslog",
+            "orderByTime": "ASC",
+            "policy": "default",
+            "refId": "A",
+            "resultFormat": "table",
+            "select": [
+              [
+                {
+                  "params": [
+                    "severity_code"
+                  ],
+                  "type": "field"
+                }
+              ],
+              [
+                {
+                  "params": [
+                    "message"
+                  ],
+                  "type": "field"
+                }
+              ]
+            ],
+            "tags": [
+              {
+                "key": "hostname",
+                "operator": "=~",
+                "value": "/^$hostname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "appname",
+                "operator": "=~",
+                "value": "/^$appname$/"
+              },
+              {
+                "condition": "AND",
+                "key": "severity",
+                "operator": "=~",
+                "value": "/^$severity$/"
+              },
+              {
+                "condition": "AND",
+                "key": "message",
+                "operator": "=~",
+                "value": "/$Query/"
+              }
+            ]
+          }
+        ],
+        "title": "Syslog Messages",
+        "type": "table"
+      }
+    ],
+    "refresh": "5s",
+    "schemaVersion": 38,
+    "tags": [],
+    "templating": {
+      "list": [
+        {
+          "allValue": "",
+          "current": {
+            "selected": false,
+            "text": "All",
+            "value": "$__all"
+          },
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "definition": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+          "hide": 0,
+          "includeAll": true,
+          "label": "Appname",
+          "multi": true,
+          "name": "appname",
+          "options": [],
+          "query": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+          "refresh": 2,
+          "regex": "",
+          "skipUrlSync": false,
+          "sort": 1,
+          "tagValuesQuery": "",
+          "tagsQuery": "",
+          "type": "query",
+          "useTags": false
+        },
+        {
+          "allValue": "",
+          "current": {
+            "selected": false,
+            "text": "All",
+            "value": "$__all"
+          },
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "definition": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+          "hide": 0,
+          "includeAll": true,
+          "label": "Hostname",
+          "multi": true,
+          "name": "hostname",
+          "options": [],
+          "query": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+          "refresh": 2,
+          "regex": "",
+          "skipUrlSync": false,
+          "sort": 1,
+          "tagValuesQuery": "",
+          "tagsQuery": "",
+          "type": "query",
+          "useTags": false
+        },
+        {
+          "allValue": "",
+          "current": {
+            "selected": false,
+            "text": "All",
+            "value": "$__all"
+          },
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "definition": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+          "hide": 0,
+          "includeAll": true,
+          "label": "Severity",
+          "multi": true,
+          "name": "severity",
+          "options": [],
+          "query": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+          "refresh": 2,
+          "regex": "",
+          "skipUrlSync": false,
+          "sort": 0,
+          "tagValuesQuery": "",
+          "tagsQuery": "",
+          "type": "query",
+          "useTags": false
+        },
+        {
+          "current": {
+            "selected": false,
+            "text": "",
+            "value": ""
+          },
+          "description": "Querystring",
+          "hide": 0,
+          "label": "MessageQuery",
+          "name": "Query",
+          "options": [
+            {
+              "selected": true,
+              "text": "",
+              "value": ""
+            }
+          ],
+          "query": "",
+          "skipUrlSync": false,
+          "type": "textbox"
+        }
+      ]
+    },
+    "time": {
+      "from": "now-1h",
+      "to": "now"
+    },
+    "timepicker": {
+      "refresh_intervals": [
+        "5s",
+        " 10s",
+        " 30s",
+        " 1m",
+        " 5m"
+      ],
+      "time_options": [
+        "5m",
+        "15m",
+        "1h",
+        "6h",
+        "12h",
+        "24h",
+        "2d",
+        "7d",
+        "30d"
+      ]
+    },
+    "timezone": "",
+    "title": "Syslog",
+    "uid": "TIYeHqRgZ",
+    "version": 2,
+    "weekStart": ""
+  }
\ No newline at end of file

changed: [akhkusu-3] => (item=syslog.json)
--- before
+++ after: /home/aki/ica0002/roles/grafana/files/backups.json
@@ -0,0 +1,233 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "grafana",
+            "uid": "-- Grafana --"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "type": "dashboard"
+        }
+      ]
+    },
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "graphTooltip": 0,
+    "id": 4,
+    "links": [],
+    "panels": [
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            },
+            "unit": "s"
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 4,
+          "w": 3,
+          "x": 0,
+          "y": 0
+        },
+        "id": 3,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "11.4.0",
+        "targets": [
+          {
+            "editorMode": "code",
+            "expr": "time() - backup_last_success_time{user=\"akhkusu\", service=\"influxdb\"}",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Last Backup Success  InfluxDB",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            },
+            "unit": "s"
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 4,
+          "w": 3,
+          "x": 3,
+          "y": 0
+        },
+        "id": 2,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "11.4.0",
+        "targets": [
+          {
+            "editorMode": "code",
+            "expr": "time() - backup_last_success_time{user=\"akhkusu\", service=\"mysql\"}",
+            "legendFormat": "__auto",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Last Backup Success MySQL",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                },
+                {
+                  "color": "red",
+                  "value": 80
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 4,
+          "w": 14,
+          "x": 6,
+          "y": 0
+        },
+        "id": 1,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "area",
+          "justifyMode": "auto",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "11.4.0",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "editorMode": "code",
+            "expr": "backups_total{user=\"akhkusu\"}",
+            "format": "heatmap",
+            "interval": "",
+            "legendFormat": "{{service}} {{type}}",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "Total Backups",
+        "type": "stat"
+      }
+    ],
+    "preload": false,
+    "schemaVersion": 40,
+    "tags": [],
+    "templating": {
+      "list": []
+    },
+    "time": {
+      "from": "now-6h",
+      "to": "now"
+    },
+    "timepicker": {},
+    "timezone": "browser",
+    "title": "Backup",
+    "uid": "ae7s0fc4q9ou8b",
+    "version": 2,
+    "weekStart": ""
+  }
\ No newline at end of file

changed: [akhkusu-3] => (item=backups.json)

TASK [grafana : Install Grafana via Docker] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [akhkusu-3]

TASK [grafana : run grafana handlers] ******************************************

RUNNING HANDLER [grafana : Restart grafana] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "restarted": false,
+    "restarted": true,
     "running": true
 }

changed: [akhkusu-3]

TASK [grafana : Make sure grafana is running] **********************************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-3]

PLAY [Nginx server] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [nginx : Install nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx nginx-common nginx-core
0 upgraded, 20 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx nginx-common nginx-core
0 upgraded, 20 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx nginx-common nginx-core
0 upgraded, 20 newly installed, 0 to remove and 131 not upgraded.
changed: [akhkusu-3]

TASK [nginx : Configure Nginx] *************************************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp4fv7uouv/default.j2
@@ -1,91 +1,22 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+server {
+    listen 80 default_server;
+    server_name _;
 
-# Default server configuration
-#
+    
+    location /prometheus {
+        proxy_pass http://prometheus:9090;
+    }
+
+    location /grafana {
+        proxy_pass http://grafana:3000;
+        proxy_set_header Host $http_host;
+    }
+
+    }
+
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
-
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}
\ No newline at end of file

changed: [akhkusu-3]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpsmtnk2ih/default.j2
@@ -1,91 +1,18 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+server {
+    listen 80 default_server;
+    server_name _;
 
-# Default server configuration
-#
+    
+    location / {
+        proxy_pass http://www-1:8001;
+        proxy_set_header Host $http_host;
+    }
+
+    }
+
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
-
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}
\ No newline at end of file

changed: [akhkusu-1]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpv7qg3zvf/default.j2
@@ -1,91 +1,18 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
+server {
+    listen 80 default_server;
+    server_name _;
 
-# Default server configuration
-#
+    
+    location / {
+        proxy_pass http://www-2:8001;
+        proxy_set_header Host $http_host;
+    }
+
+    }
+
 server {
-	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
-	server_name _;
-
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
-	}
-
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
-}
-
-
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+    listen 8080 default_server;
+    location = /stub_status {
+        stub_status;
+    }
+}
\ No newline at end of file

changed: [akhkusu-2]

TASK [nginx : meta] ************************************************************

TASK [nginx : meta] ************************************************************

TASK [nginx : meta] ************************************************************

RUNNING HANDLER [nginx : Restart Nginx] ****************************************
changed: [akhkusu-1]
changed: [akhkusu-2]
changed: [akhkusu-3]

TASK [nginx : Ensure Nginx is running and enabled on startup] ******************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 131 not upgraded.
changed: [akhkusu-3]

TASK [nginx : Ensure Prometheus Nginx Exporter is running and enabled on startup] ***
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [Agama client] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [agama_client : Install fping] ********************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 131 not upgraded.
changed: [akhkusu-3]

TASK [agama_client : Create agama-client user] *********************************
changed: [akhkusu-3]

TASK [agama_client : Add agama-client source code] *****************************
--- before
+++ after: /home/aki/ica0002/roles/agama_client/files/agama-client.sh
@@ -0,0 +1,70 @@
+#!/bin/bash -eu
+
+# Please help Dora to find problems in this script
+
+for t in database_url database_name subnet; do
+    if ! grep -q "^${t}=" /etc/agama-client/agama-client.conf; then
+        logger "$0 Failed to get $t from config"
+        exit 1
+    fi
+done
+
+which fping > /dev/null || { logger "$0 fping not found"; exit 1; }
+
+logger "Starting agama-client..."
+
+db_url=$(grep "^database_url=" /etc/agama-client/agama-client.conf | sed 's/^.*=//')
+db_name=$(grep "^database_name=" /etc/agama-client/agama-client.conf | sed 's/^.*=//')
+subnet=$(grep "^subnet=" /etc/agama-client/agama-client.conf | sed 's/^.*=//')
+
+for i in {1..30}; do
+    if $(curl -s "$db_url/ping"); then
+        logger "Will push data to $db_url"
+        break
+    else
+        logger "Failed to connect to $db_url. InfluxDB is not running? ($i)"
+        sleep 5
+    fi
+done
+
+logger "Creating database $db_name in $db_url"
+curl -i -XPOST "$db_url/query" --data-urlencode "q=CREATE DATABASE $db_name" 1>/dev/null 2>/dev/null || { logger "$0 Failed to create database"; exit 1; }
+
+while true; do
+    alive_hosts=$(fping -g $subnet -a 2>/dev/null || true)
+    logger "Discovered $(echo "$alive_hosts" | wc -l) IPs"
+    for vm_ip in $alive_hosts; do
+        # Getting content of agama page
+        content=$(curl --connect-timeout 1 -w "%{http_code}" -s $vm_ip || continue)
+        if test ${content: -3} -ne 200; then
+            # nothing to do, going to next student
+            continue
+        fi
+        # Getting where it's hosted
+        vm_name=$(echo "$content" | grep "running on" | awk '{print $5}')
+        if [ -z $vm_name ]; then
+            # No agama running, skipping
+            continue
+        fi
+        ptr=$(host -W1 $vm_ip $vm_ip | awk '/domain name pointer/ {print $5}')
+        if ! [ -z "$ptr" ]; then
+            logger "Resolved $vm_ip to $ptr"
+            vm_name="$ptr"
+        fi
+        # Number of items in agama
+        table_rows=$(echo "$content" | grep -c "</tr>")
+        # Write stats to inflixdb
+        curl -i -XPOST "${db_url}/write?db=$db_name" --data-binary "agama-stats,name=$vm_name items=$table_rows" 1>/dev/null 2>/dev/null
+        # If hostname exists in agama - delete it
+        if $(echo "$content" | grep -q $(hostname)); then
+            for delete_url in $(echo "$content" | grep $(hostname) | grep -o '/items/.*/swap-state' | sed 's/swap-state/delete/'); do
+                curl -s $vm_ip$delete_url -o /dev/null || logger "Failed to delete $(hostname) from $vm_ip"
+            done
+        fi
+        # Add new item to agama
+        curl -s -XPOST $vm_ip/items/add -F new_item="Checked from $(hostname) at $(date)" -o /dev/null || logger "Failed to update Agama on $vm_ip"
+        logger "Posted check message to $vm_ip"
+    done
+    logger "Waiting for the next cycle to start..."
+    sleep 300
+done
\ No newline at end of file

changed: [akhkusu-3]

TASK [agama_client : Add agama-client service] *********************************
--- before
+++ after: /home/aki/ica0002/roles/agama_client/files/agama-client.service
@@ -0,0 +1,11 @@
+[Unit]
+Description=Agma-client
+Documentation=Go to https://github.com/romankuchin/ica0002-2024/
+After=network-online.target
+
+[Service]
+User=agama-client
+ExecStart=/usr/local/bin/agama-client
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [akhkusu-3]

TASK [agama_client : Create agama-client folder] *******************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/agama-client",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-3]

TASK [agama_client : Add agama-client conf] ************************************
--- before
+++ after: /home/aki/ica0002/roles/agama_client/files/agama-client.conf
@@ -0,0 +1,3 @@
+database_url=localhost:8086
+database_name=Result
+subnet=192.168.0.0/24
\ No newline at end of file

changed: [akhkusu-3]

TASK [agama_client : Start agama-client] ***************************************
changed: [akhkusu-3]

RUNNING HANDLER [agama_client : Restart systemctl daemon] **********************
ok: [akhkusu-3]

PLAY [HAProxy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Install HAProxy] ***********************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]

TASK [haproxy : Add haproxy configuration] *************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpf2rm5ukf/haproxy.cfg.j2
@@ -1,34 +1,45 @@
 global
-	log /dev/log	local0
-	log /dev/log	local1 notice
-	chroot /var/lib/haproxy
-	stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
-	stats timeout 30s
-	user haproxy
-	group haproxy
-	daemon
+        log /dev/log    local0
+        log /dev/log    local1 notice
+        chroot /var/lib/haproxy
+        stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
+        stats timeout 30s
+        user haproxy
+        group haproxy
+        daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
-	log	global
-	mode	http
-	option	httplog
-	option	dontlognull
+        log     global
+        mode    http
+        option  httplog
+        option  dontlognull
         timeout connect 5000
         timeout client  50000
         timeout server  50000
-	errorfile 400 /etc/haproxy/errors/400.http
-	errorfile 403 /etc/haproxy/errors/403.http
-	errorfile 408 /etc/haproxy/errors/408.http
-	errorfile 500 /etc/haproxy/errors/500.http
-	errorfile 502 /etc/haproxy/errors/502.http
-	errorfile 503 /etc/haproxy/errors/503.http
-	errorfile 504 /etc/haproxy/errors/504.http
+        errorfile 400 /etc/haproxy/errors/400.http
+        errorfile 403 /etc/haproxy/errors/403.http
+        errorfile 408 /etc/haproxy/errors/408.http
+        errorfile 500 /etc/haproxy/errors/500.http
+        errorfile 502 /etc/haproxy/errors/502.http
+        errorfile 503 /etc/haproxy/errors/503.http
+        errorfile 504 /etc/haproxy/errors/504.http
+
+listen my_ha_frontend
+        bind :88
+
+        
+        server vm-1-0 lb-1:8001 check
+        server vm-2-0 lb-2:8001 check
+        
+        server vm-1-1 lb-1:8002 check
+        server vm-2-1 lb-2:8002 check
+        
+        server vm-1-2 lb-1:8003 check
+        server vm-2-2 lb-2:8003 check
+        
+listen stats
+        bind :9188
+        stats enable
+        stats uri /status
+        stats refresh 5s 

changed: [akhkusu-1]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp9462p7dh/haproxy.cfg.j2
@@ -1,34 +1,45 @@
 global
-	log /dev/log	local0
-	log /dev/log	local1 notice
-	chroot /var/lib/haproxy
-	stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
-	stats timeout 30s
-	user haproxy
-	group haproxy
-	daemon
+        log /dev/log    local0
+        log /dev/log    local1 notice
+        chroot /var/lib/haproxy
+        stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
+        stats timeout 30s
+        user haproxy
+        group haproxy
+        daemon
 
-	# Default SSL material locations
-	ca-base /etc/ssl/certs
-	crt-base /etc/ssl/private
-
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
 
 defaults
-	log	global
-	mode	http
-	option	httplog
-	option	dontlognull
+        log     global
+        mode    http
+        option  httplog
+        option  dontlognull
         timeout connect 5000
         timeout client  50000
         timeout server  50000
-	errorfile 400 /etc/haproxy/errors/400.http
-	errorfile 403 /etc/haproxy/errors/403.http
-	errorfile 408 /etc/haproxy/errors/408.http
-	errorfile 500 /etc/haproxy/errors/500.http
-	errorfile 502 /etc/haproxy/errors/502.http
-	errorfile 503 /etc/haproxy/errors/503.http
-	errorfile 504 /etc/haproxy/errors/504.http
+        errorfile 400 /etc/haproxy/errors/400.http
+        errorfile 403 /etc/haproxy/errors/403.http
+        errorfile 408 /etc/haproxy/errors/408.http
+        errorfile 500 /etc/haproxy/errors/500.http
+        errorfile 502 /etc/haproxy/errors/502.http
+        errorfile 503 /etc/haproxy/errors/503.http
+        errorfile 504 /etc/haproxy/errors/504.http
+
+listen my_ha_frontend
+        bind :88
+
+        
+        server vm-1-0 lb-1:8001 check
+        server vm-2-0 lb-2:8001 check
+        
+        server vm-1-1 lb-1:8002 check
+        server vm-2-1 lb-2:8002 check
+        
+        server vm-1-2 lb-1:8003 check
+        server vm-2-2 lb-2:8003 check
+        
+listen stats
+        bind :9188
+        stats enable
+        stats uri /status
+        stats refresh 5s 

changed: [akhkusu-2]

TASK [haproxy : Start HAProxy] *************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Install prometheus-haproxy-exporter] ***************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]

TASK [haproxy : Start prometheus-haproxy-exporter] *****************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Configure prometheus-haproxy-exporter] *************************
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp0tkl_1h_/prometheus-haproxy-exporter
@@ -1,8 +1,9 @@
-# Set the command-line arguments to pass to the server.
+prometheus-haproxy-exporte# Set the command-line arguments to pass to the server.
 # Due to shell scaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+haproxy_exporter_port: 9101
+ARGS="--haproxy.scrape-uri='http://akhkusu-1:9101/status/;csv'"
 
 # Prometheus-haproxy-exporter supports the following options:
 #
@@ -32,4 +33,4 @@
 #    Valid levels: [debug, info, warn, error, fatal]
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
\ No newline at end of file

changed: [akhkusu-1]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpn8520bzi/prometheus-haproxy-exporter
@@ -1,8 +1,9 @@
-# Set the command-line arguments to pass to the server.
+prometheus-haproxy-exporte# Set the command-line arguments to pass to the server.
 # Due to shell scaping, to pass backslashes for regexes, you need to double
 # them (\\d for \d). If running under systemd, you need to double them again
 # (\\\\d to mean \d), and escape newlines too.
-ARGS=""
+haproxy_exporter_port: 9101
+ARGS="--haproxy.scrape-uri='http://akhkusu-2:9101/status/;csv'"
 
 # Prometheus-haproxy-exporter supports the following options:
 #
@@ -32,4 +33,4 @@
 #    Valid levels: [debug, info, warn, error, fatal]
 #  --log.format="logger:stderr"
 #    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
\ No newline at end of file

changed: [akhkusu-2]

TASK [add cnames] **************************************************************
included: cname for akhkusu-1, akhkusu-2

TASK [cname : add cnames records] **********************************************
changed: [akhkusu-1]
changed: [akhkusu-2]

RUNNING HANDLER [haproxy : Restart haproxy] ************************************
changed: [akhkusu-1]
changed: [akhkusu-2]

RUNNING HANDLER [haproxy : Restart prometheus-haproxy-exporter] ****************
changed: [akhkusu-2]
changed: [akhkusu-1]

PLAY [Keepalived] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : set_fact] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : set_fact] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Make keepalived directory] **********************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/keepalived/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/keepalived/",
-    "state": "absent"
+    "state": "directory"
 }

changed: [akhkusu-1]

TASK [keepalived : Install keepalived] *****************************************
The following additional packages will be installed:
  ipvsadm libsensors-config libsensors5 libsnmp-base libsnmp40
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libsensors-config libsensors5 libsnmp-base libsnmp40
0 upgraded, 6 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-1]
The following additional packages will be installed:
  ipvsadm libsensors-config libsensors5 libsnmp-base libsnmp40
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libsensors-config libsensors5 libsnmp-base libsnmp40
0 upgraded, 6 newly installed, 0 to remove and 130 not upgraded.
changed: [akhkusu-2]

TASK [keepalived : Create user keepalived script] ******************************
changed: [akhkusu-1]
changed: [akhkusu-2]

TASK [keepalived : Move keepalived script] *************************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp3x3nt5zi/keep_script.sh
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '
\ No newline at end of file

changed: [akhkusu-1]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmptjiuqwia/keep_script.sh
@@ -0,0 +1,2 @@
+#!/bin/bash
+ss -ntl | grep -q ':88 '
\ No newline at end of file

changed: [akhkusu-2]

TASK [keepalived : Move keepalived conf] ***************************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [keepalived : Make sure keepalaived is running away!] *********************
changed: [akhkusu-1]
changed: [akhkusu-2]

TASK [keepalived : Download Keepalive exporter package] ************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [keepalived : Install Keepalived exporter package] ************************
changed: [akhkusu-2]
changed: [akhkusu-1]

TASK [keepalived : Move Keep alive service] ************************************
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmp1pr3p0pn/keepalived-exporter.service
@@ -0,0 +1,11 @@
+[Unit]
+Description=Keepalived Expordado
+Documentation=https://github.com/mehdy/keepalived-exporter
+After=network-online.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/keepalived-exporter-1.2.0.linux-amd64/keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [akhkusu-2]
--- before
+++ after: /home/aki/.ansible/tmp/ansible-local-407983exv98u35/tmpeoi424t0/keepalived-exporter.service
@@ -0,0 +1,11 @@
+[Unit]
+Description=Keepalived Expordado
+Documentation=https://github.com/mehdy/keepalived-exporter
+After=network-online.target
+
+[Service]
+User=root
+ExecStart=/usr/local/bin/keepalived-exporter-1.2.0.linux-amd64/keepalived-exporter
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [akhkusu-1]

TASK [keepalived : Start keep alive service] ***********************************
changed: [akhkusu-2]
changed: [akhkusu-1]

RUNNING HANDLER [keepalived : Restart keepalived] ******************************
changed: [akhkusu-2]
changed: [akhkusu-1]

RUNNING HANDLER [keepalived : Restart systemd daemon] **************************
ok: [akhkusu-1]
ok: [akhkusu-2]

PLAY RECAP *********************************************************************
akhkusu-1                  : ok=91   changed=68   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
akhkusu-2                  : ok=91   changed=68   unreachable=0    failed=0    skipped=4    rescued=0    ignored=0   
akhkusu-3                  : ok=93   changed=71   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

+ ansible-playbook infra.yaml --diff

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host akhkusu-2 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host akhkusu-1 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host akhkusu-3 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [init : Update APT cache] *************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [init : Install Prometheus node exporters] ********************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [init : Modify rsyslog conf file] *****************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [init : Create backup user] ***********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [init : Add backup server to known hosts] *********************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [init : Create restore directory] *****************************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [init : Install duplicity] ************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [Bind9] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [bind : install bind9] ****************************************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [bind : copy conf.options] ************************************************
ok: [akhkusu-3] => (item=options)
ok: [akhkusu-1] => (item=options)
ok: [akhkusu-2] => (item=options)
ok: [akhkusu-2] => (item=local)
ok: [akhkusu-1] => (item=local)
ok: [akhkusu-3] => (item=local)

TASK [bind : copy zone] ********************************************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : copy reverse zone] ************************************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : Download Bind9 Exporter archive] **********************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [bind : Extract Bind9 Exporter archive] ***********************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [bind : Create symbolic link to exporter executable] **********************
ok: [akhkusu-3]
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [bind : Create systemd service definition for Bind9 Exporter] *************
ok: [akhkusu-3]
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [bind : Make sure bind9 and exporter are running] *************************
ok: [akhkusu-2] => (item=bind9)
ok: [akhkusu-1] => (item=bind9)
ok: [akhkusu-3] => (item=bind9)
ok: [akhkusu-3] => (item=bind_exporter)
ok: [akhkusu-2] => (item=bind_exporter)
ok: [akhkusu-1] => (item=bind_exporter)

TASK [bind : Run handlers] *****************************************************

TASK [bind : Run handlers] *****************************************************

TASK [bind : Run handlers] *****************************************************

TASK [bind : install dependency for nsupdate] **********************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [bind : Add A backup record on backup dns servers] ************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3, akhkusu-1, akhkusu-2

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [dns] *********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [dns : Resolv.conf] *******************************************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [dns : Stop systemd-resolved] *********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [docker] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [docker : Install docker] *************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [docker : Start docker] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : install MySQL] ***************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Manage mysql host] ***********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : install PyMySQL] *************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Create MySQL database] *******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : MySQL user] ******************************************************
[WARNING]: Option column_case_sensitive is not provided. The default is now
false, so the column's name will be uppercased. The default will be changed to
true in community.mysql 4.0.0.
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Make sure mysql is running] **************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : MySQL Exporter User] *********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : MySQL Exporter Config] *******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Install MySQL Exporter] ******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Enable MySQL Exporter] *******************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Add mysql replication user] **************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Configure mysql dynamic variables for replica] *******************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create backup directory for mysql] *******************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create mysql backup user] ****************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create backup user credentials to access mysql] ******************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create scheduled mysql backup task with cron] ********************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [add cnames] **************************************************************
included: cname for akhkusu-2, akhkusu-1

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

PLAY [Agama_servers] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [agama : Create agama volume directory] ***********************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [agama : Download agama files] ********************************************
ok: [akhkusu-1] => (item=agama.py)
ok: [akhkusu-2] => (item=agama.py)
ok: [akhkusu-3] => (item=agama.py)
ok: [akhkusu-1] => (item=Dockerfile)
ok: [akhkusu-2] => (item=Dockerfile)
ok: [akhkusu-3] => (item=Dockerfile)

TASK [agama : Create agama docker image] ***************************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [agama : Start agama docker container] ************************************
ok: [akhkusu-3] => (item=None)
ok: [akhkusu-1] => (item=None)
ok: [akhkusu-2] => (item=None)
ok: [akhkusu-2] => (item=None)
ok: [akhkusu-3] => (item=None)
ok: [akhkusu-1] => (item=None)
ok: [akhkusu-2] => (item=None)
ok: [akhkusu-2]
ok: [akhkusu-1] => (item=None)
ok: [akhkusu-1]
ok: [akhkusu-3] => (item=None)
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-1, akhkusu-2, akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [prometheus : Install Prometheus] *****************************************
ok: [akhkusu-3]

TASK [prometheus : Modify /etc/prometheus/prometheus.yml] **********************
ok: [akhkusu-3]

TASK [prometheus : Copy Prometheus default file] *******************************
ok: [akhkusu-3]

TASK [prometheus : Enable Prometheus] ******************************************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]

PLAY [Influxdb] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [influxdb : Download influxdb] ********************************************
ok: [akhkusu-3]

TASK [influxdb : Install influxdb] *********************************************
ok: [akhkusu-3]

TASK [influxdb : Configure influxdb] *******************************************
ok: [akhkusu-3]

TASK [influxdb : Activate influxdb] ********************************************
ok: [akhkusu-3]

TASK [influxdb : Get telegraf key] *********************************************
ok: [akhkusu-3]

TASK [influxdb : Get telegraf source with apt] *********************************
ok: [akhkusu-3]

TASK [influxdb : Install telegraf from source] *********************************
ok: [akhkusu-3]

TASK [influxdb : Configure telegraf] *******************************************
ok: [akhkusu-3]

TASK [influxdb : Download influxdb exporter] ***********************************
ok: [akhkusu-3]

TASK [influxdb : Create influxdb-exporter service] *****************************
ok: [akhkusu-3]

TASK [influxdb : Start prometheus-influxdb-stats-exporter] *********************
ok: [akhkusu-3]

TASK [influxdb : Create backup directory for influxdb] *************************
ok: [akhkusu-3]

TASK [influxdb : Create scheduled influxdb backup task with cron] **************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [grafana : Create volume directories] *************************************
ok: [akhkusu-3] => (item=dashboards)
ok: [akhkusu-3] => (item=datasources)

TASK [grafana : Copy grafana configs to volume] ********************************
ok: [akhkusu-3]

TASK [grafana : Copy dashboards config to volume] ******************************
ok: [akhkusu-3]

TASK [grafana : Copy datasources config to volume] *****************************
ok: [akhkusu-3]

TASK [grafana : Copy all dashboards to volume] *********************************
ok: [akhkusu-3] => (item=main.json)
ok: [akhkusu-3] => (item=mysql.json)
ok: [akhkusu-3] => (item=syslog.json)
ok: [akhkusu-3] => (item=backups.json)

TASK [grafana : Install Grafana via Docker] ************************************
ok: [akhkusu-3]

TASK [grafana : run grafana handlers] ******************************************

TASK [grafana : Make sure grafana is running] **********************************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]

PLAY [Nginx server] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : Install nginx] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [nginx : Configure Nginx] *************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : meta] ************************************************************

TASK [nginx : meta] ************************************************************

TASK [nginx : meta] ************************************************************

TASK [nginx : Ensure Nginx is running and enabled on startup] ******************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [nginx : Ensure Prometheus Nginx Exporter is running and enabled on startup] ***
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

PLAY [Agama client] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [agama_client : Install fping] ********************************************
ok: [akhkusu-3]

TASK [agama_client : Create agama-client user] *********************************
ok: [akhkusu-3]

TASK [agama_client : Add agama-client source code] *****************************
ok: [akhkusu-3]

TASK [agama_client : Add agama-client service] *********************************
ok: [akhkusu-3]

TASK [agama_client : Create agama-client folder] *******************************
ok: [akhkusu-3]

TASK [agama_client : Add agama-client conf] ************************************
ok: [akhkusu-3]

TASK [agama_client : Start agama-client] ***************************************
ok: [akhkusu-3]

PLAY [HAProxy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Install HAProxy] ***********************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Add haproxy configuration] *************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Start HAProxy] *************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Install prometheus-haproxy-exporter] ***************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Start prometheus-haproxy-exporter] *****************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Configure prometheus-haproxy-exporter] *************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [add cnames] **************************************************************
included: cname for akhkusu-1, akhkusu-2

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

PLAY [Keepalived] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : set_fact] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : set_fact] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Make keepalived directory] **********************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Install keepalived] *****************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Create user keepalived script] ******************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Move keepalived script] *************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Move keepalived conf] ***************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Make sure keepalaived is running away!] *********************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Download Keepalive exporter package] ************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Install Keepalived exporter package] ************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Move Keep alive service] ************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Start keep alive service] ***********************************
ok: [akhkusu-1]
ok: [akhkusu-2]

PLAY RECAP *********************************************************************
akhkusu-1                  : ok=79   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
akhkusu-2                  : ok=79   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
akhkusu-3                  : ok=82   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

+ ansible all -b -m reboot -a test_command=uptime
akhkusu-1 | CHANGED => {
    "changed": true,
    "elapsed": 48,
    "rebooted": true
}
akhkusu-2 | CHANGED => {
    "changed": true,
    "elapsed": 51,
    "rebooted": true
}
akhkusu-3 | CHANGED => {
    "changed": true,
    "elapsed": 51,
    "rebooted": true
}
+ sleep 15
+ ansible-playbook infra.yaml --diff

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
[WARNING]: Platform linux on host akhkusu-2 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host akhkusu-1 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
[WARNING]: Platform linux on host akhkusu-3 is using the discovered Python
interpreter at /usr/bin/python3.10, but future installation of another Python
interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [init : Update APT cache] *************************************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [init : Install Prometheus node exporters] ********************************
ok: [akhkusu-2]
ok: [akhkusu-3]
ok: [akhkusu-1]

TASK [init : Modify rsyslog conf file] *****************************************
ok: [akhkusu-3]
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [init : Create backup user] ***********************************************
ok: [akhkusu-3]
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [init : Add backup server to known hosts] *********************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [init : Create restore directory] *****************************************
ok: [akhkusu-3]
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [init : Install duplicity] ************************************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

PLAY [Bind9] *******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : install bind9] ****************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [bind : copy conf.options] ************************************************
ok: [akhkusu-3] => (item=options)
ok: [akhkusu-2] => (item=options)
ok: [akhkusu-1] => (item=options)
ok: [akhkusu-2] => (item=local)
ok: [akhkusu-1] => (item=local)
ok: [akhkusu-3] => (item=local)

TASK [bind : copy zone] ********************************************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : copy reverse zone] ************************************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : Download Bind9 Exporter archive] **********************************
ok: [akhkusu-3]
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [bind : Extract Bind9 Exporter archive] ***********************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [bind : Create symbolic link to exporter executable] **********************
ok: [akhkusu-3]
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [bind : Create systemd service definition for Bind9 Exporter] *************
ok: [akhkusu-3]
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [bind : Make sure bind9 and exporter are running] *************************
ok: [akhkusu-1] => (item=bind9)
ok: [akhkusu-2] => (item=bind9)
ok: [akhkusu-3] => (item=bind9)
ok: [akhkusu-2] => (item=bind_exporter)
ok: [akhkusu-1] => (item=bind_exporter)
ok: [akhkusu-3] => (item=bind_exporter)

TASK [bind : Run handlers] *****************************************************

TASK [bind : Run handlers] *****************************************************

TASK [bind : Run handlers] *****************************************************

TASK [bind : install dependency for nsupdate] **********************************
ok: [akhkusu-3]
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [bind : Add A backup record on backup dns servers] ************************
skipping: [akhkusu-1]
skipping: [akhkusu-2]
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3, akhkusu-1, akhkusu-2

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]
ok: [akhkusu-2]
ok: [akhkusu-1]

PLAY [dns] *********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [dns : Resolv.conf] *******************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [dns : Stop systemd-resolved] *********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [docker] ******************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [docker : Install docker] *************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

TASK [docker : Start docker] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : install MySQL] ***************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Manage mysql host] ***********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : install PyMySQL] *************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Create MySQL database] *******************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : MySQL user] ******************************************************
[WARNING]: Option column_case_sensitive is not provided. The default is now
false, so the column's name will be uppercased. The default will be changed to
true in community.mysql 4.0.0.
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Make sure mysql is running] **************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : MySQL Exporter User] *********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : MySQL Exporter Config] *******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Install MySQL Exporter] ******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Enable MySQL Exporter] *******************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Add mysql replication user] **************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Configure mysql dynamic variables for replica] *******************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create backup directory for mysql] *******************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create mysql backup user] ****************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [mysql : Create backup user credentials to access mysql] ******************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [mysql : Create scheduled mysql backup task with cron] ********************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [add cnames] **************************************************************
included: cname for akhkusu-2, akhkusu-1

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

PLAY [Agama_servers] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [agama : Create agama volume directory] ***********************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [agama : Download agama files] ********************************************
ok: [akhkusu-2] => (item=agama.py)
ok: [akhkusu-1] => (item=agama.py)
ok: [akhkusu-3] => (item=agama.py)
ok: [akhkusu-3] => (item=Dockerfile)
ok: [akhkusu-2] => (item=Dockerfile)
ok: [akhkusu-1] => (item=Dockerfile)

TASK [agama : Create agama docker image] ***************************************
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

TASK [agama : Start agama docker container] ************************************
ok: [akhkusu-2] => (item=None)
ok: [akhkusu-1] => (item=None)
ok: [akhkusu-3] => (item=None)
ok: [akhkusu-1] => (item=None)
ok: [akhkusu-2] => (item=None)
ok: [akhkusu-3] => (item=None)
ok: [akhkusu-2] => (item=None)
ok: [akhkusu-2]
ok: [akhkusu-1] => (item=None)
ok: [akhkusu-1]
ok: [akhkusu-3] => (item=None)
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-1, akhkusu-2, akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]
ok: [akhkusu-3]

PLAY [Prometheus] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [prometheus : Install Prometheus] *****************************************
ok: [akhkusu-3]

TASK [prometheus : Modify /etc/prometheus/prometheus.yml] **********************
ok: [akhkusu-3]

TASK [prometheus : Copy Prometheus default file] *******************************
ok: [akhkusu-3]

TASK [prometheus : Enable Prometheus] ******************************************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]

PLAY [Influxdb] ****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [influxdb : Download influxdb] ********************************************
ok: [akhkusu-3]

TASK [influxdb : Install influxdb] *********************************************
ok: [akhkusu-3]

TASK [influxdb : Configure influxdb] *******************************************
ok: [akhkusu-3]

TASK [influxdb : Activate influxdb] ********************************************
ok: [akhkusu-3]

TASK [influxdb : Get telegraf key] *********************************************
ok: [akhkusu-3]

TASK [influxdb : Get telegraf source with apt] *********************************
ok: [akhkusu-3]

TASK [influxdb : Install telegraf from source] *********************************
ok: [akhkusu-3]

TASK [influxdb : Configure telegraf] *******************************************
ok: [akhkusu-3]

TASK [influxdb : Download influxdb exporter] ***********************************
ok: [akhkusu-3]

TASK [influxdb : Create influxdb-exporter service] *****************************
ok: [akhkusu-3]

TASK [influxdb : Start prometheus-influxdb-stats-exporter] *********************
ok: [akhkusu-3]

TASK [influxdb : Create backup directory for influxdb] *************************
ok: [akhkusu-3]

TASK [influxdb : Create scheduled influxdb backup task with cron] **************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]

PLAY [Grafana] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [grafana : Create volume directories] *************************************
ok: [akhkusu-3] => (item=dashboards)
ok: [akhkusu-3] => (item=datasources)

TASK [grafana : Copy grafana configs to volume] ********************************
ok: [akhkusu-3]

TASK [grafana : Copy dashboards config to volume] ******************************
ok: [akhkusu-3]

TASK [grafana : Copy datasources config to volume] *****************************
ok: [akhkusu-3]

TASK [grafana : Copy all dashboards to volume] *********************************
ok: [akhkusu-3] => (item=main.json)
ok: [akhkusu-3] => (item=mysql.json)
ok: [akhkusu-3] => (item=syslog.json)
ok: [akhkusu-3] => (item=backups.json)

TASK [grafana : Install Grafana via Docker] ************************************
ok: [akhkusu-3]

TASK [grafana : run grafana handlers] ******************************************

TASK [grafana : Make sure grafana is running] **********************************
ok: [akhkusu-3]

TASK [add cnames] **************************************************************
included: cname for akhkusu-3

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-3]

PLAY [Nginx server] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : Install nginx] ***************************************************
ok: [akhkusu-3]
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [nginx : Configure Nginx] *************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : meta] ************************************************************

TASK [nginx : meta] ************************************************************

TASK [nginx : meta] ************************************************************

TASK [nginx : Ensure Nginx is running and enabled on startup] ******************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [akhkusu-1]
ok: [akhkusu-2]
ok: [akhkusu-3]

TASK [nginx : Ensure Prometheus Nginx Exporter is running and enabled on startup] ***
ok: [akhkusu-1]
ok: [akhkusu-3]
ok: [akhkusu-2]

PLAY [Agama client] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-3]

TASK [agama_client : Install fping] ********************************************
ok: [akhkusu-3]

TASK [agama_client : Create agama-client user] *********************************
ok: [akhkusu-3]

TASK [agama_client : Add agama-client source code] *****************************
ok: [akhkusu-3]

TASK [agama_client : Add agama-client service] *********************************
ok: [akhkusu-3]

TASK [agama_client : Create agama-client folder] *******************************
ok: [akhkusu-3]

TASK [agama_client : Add agama-client conf] ************************************
ok: [akhkusu-3]

TASK [agama_client : Start agama-client] ***************************************
ok: [akhkusu-3]

PLAY [HAProxy] *****************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Install HAProxy] ***********************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Add haproxy configuration] *************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Start HAProxy] *************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [haproxy : Install prometheus-haproxy-exporter] ***************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Start prometheus-haproxy-exporter] *****************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [haproxy : Configure prometheus-haproxy-exporter] *************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [add cnames] **************************************************************
included: cname for akhkusu-1, akhkusu-2

TASK [cname : add cnames records] **********************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

PLAY [Keepalived] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : set_fact] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : set_fact] ***************************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Make keepalived directory] **********************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Install keepalived] *****************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Create user keepalived script] ******************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Move keepalived script] *************************************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Move keepalived conf] ***************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Make sure keepalaived is running away!] *********************
ok: [akhkusu-2]
ok: [akhkusu-1]

TASK [keepalived : Download Keepalive exporter package] ************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Install Keepalived exporter package] ************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Move Keep alive service] ************************************
ok: [akhkusu-1]
ok: [akhkusu-2]

TASK [keepalived : Start keep alive service] ***********************************
ok: [akhkusu-2]
ok: [akhkusu-1]

PLAY RECAP *********************************************************************
akhkusu-1                  : ok=79   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
akhkusu-2                  : ok=79   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
akhkusu-3                  : ok=82   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

+ date
Tue Dec 31 05:08:29 EST 2024
